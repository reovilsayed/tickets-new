"use strict";FLIPBOOK.BookSwipe=class extends FLIPBOOK.Book{constructor(i,s,e,t){super(e,t),this.singlePage&&(this.view=1),this.slides=[],this.pagesArr=[],this.leftPage=0,this.rightPage=0,this.rotation=0,this.prevPageEnabled=!1,this.setRightIndex(t.rightToLeft?t.pages.length:0),this.currentSlide=0,this.flipping=!1,this.wrapper=s,this.scroller=i,this.scroller.classList.remove("book"),this.scroller.classList.add("flipbook-carousel-scroller"),this.iscroll=new IScroll(this.wrapper,{snap:!0,snapSpeed:200*this.options.pageFlipDuration,freeScroll:!0,scrollX:!0,scrollY:!1,preventDefault:!1,eventPassthrough:"vertical"});var l=this;this.zoomDisabled=!1,this.iscroll.on("scrollStart",(function(){l.zoomDisabled=!0})),this.iscroll.on("scrollEnd",(function(){l.zoomDisabled=!1}));for(var h=0;h<3;h++){var o=document.createElement("div");o.className="flipbook-carousel-slide";var r=document.createElement("div");r.className="slide-inner",o.appendChild(r),this.scroller.appendChild(o),this.slides.push(o)}this.slides[0].iscroll=new IScroll(this.slides[0],{zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,keepInCenterV:!0,keepInCenterH:!0,preventDefault:!1}),this.slides[2].iscroll=new IScroll(this.slides[2],{zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,keepInCenterV:!0,keepInCenterH:!0,preventDefault:!1}),this.slides[1].iscroll=new IScroll(this.slides[1],{zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,keepInCenterV:!0,keepInCenterH:!0,preventDefault:!1});for(h=0;h<3;h++)this.slides[h].iscroll.on("zoomEnd",(function(){var i=t.main.zoom;this.options.eventPassthrough=i>1?"":"vertical",this.options.freeScroll=i>1,this.refresh()}));this.resizeInnerSlides(),t.pages.forEach(((i,s)=>{if(!i.empty){const e=new FLIPBOOK.PageSwipe(this,s,i.src,i.htmlContent);this.pagesArr.push(e),t.loadAllPages&&e.load()}})),this.iscroll.on("scrollStart",(function(){this.distX<0?l.loadNextSpread():l.loadPrevSpread()})),this.iscroll.on("scrollEnd",(function(){var i=this.currentPage.pageX;l.currentSlide!=i&&(l.singlePage?i>l.currentSlide?l.setRightIndex(l.rightIndex+1):i<l.currentSlide&&l.setRightIndex(l.rightIndex-1):i>l.currentSlide?l.setRightIndex(l.rightIndex+2):i<l.currentSlide&&l.setRightIndex(l.rightIndex-2),l.currentSlide=i,l.updateVisiblePages(),l.flipping=!1,l.wrapper.style.pointerEvents="")})),this.flipEnabled=!0,this.nextEnabled=!0,this.prevEnabled=!0,e.on("enableIScroll",(()=>{this.enableIscroll()})),e.on("disableIScroll",(()=>{this.disableIscroll()})),e.on("pageLoaded",(function(i){}))}enableIscroll(){this.iscrollDisabled&&(this.zoom>1?(this.slides[0].iscroll&&this.slides[0].iscroll.enable(),this.slides[1].iscroll&&this.slides[1].iscroll.enable(),this.slides[2].iscroll&&this.slides[2].iscroll.enable()):this.iscroll.enable(),this.iscrollDisabled=!1)}disableIscroll(){this.iscrollDisabled||(this.zoom>1?(this.slides[0].iscroll&&(this.slides[0].iscroll.disable(),this.slides[0].iscroll.initiated=!1),this.slides[1].iscroll&&(this.slides[1].iscroll.disable(),this.slides[1].iscroll.initiated=!1),this.slides[2].iscroll&&(this.slides[2].iscroll.disable(),this.slides[2].iscroll.initiated=!1)):(this.iscroll.disable(),this.iscroll.initiated=!1),this.iscrollDisabled=!0)}goToPage(i,s){if(this.enabled&&this.flipEnabled){if(i>2*this.numSheets&&(i=2*this.numSheets),(this.singlePage||i%2!=0)&&i--,(isNaN(i)||i<0)&&(i=0),s)return this.setRightIndex(i),void this.updateVisiblePages();this.singlePage?i>this.rightIndex?(this.setSlidePages(this.currentSlide+1,[i]),this.setRightIndex(i-1),this.nextPage(s)):i<this.rightIndex&&(this.setSlidePages(this.currentSlide-1,[i]),this.setRightIndex(i+1),this.prevPage(s)):(this.options.rightToLeft&&!this.options.backCover&&i<2&&(i=2),i>this.rightIndex?i>=this.pagesArr.length?(this.setSlidePages(2,[i-1,i]),this.setRightIndex(i-2),this.goToSlide(2,s)):(this.setSlidePages(this.currentSlide+1,[i-1,i]),this.setRightIndex(i-2),this.nextPage(s)):i<this.rightIndex&&(0==i?(this.setRightIndex(i+2),this.setSlidePages(0,[i]),this.goToSlide(0,s)):(this.setRightIndex(i+2),this.setSlidePages(this.currentSlide-1,[i-1,i]),this.prevPage(s))))}}setRightIndex(i){this.rightIndex=i}nextPage=function(i){2!=this.currentSlide&&(this.goToSlide(this.currentSlide+1,i),this.loadNextSpread())};prevPage(i){0!=this.currentSlide&&(this.goToSlide(this.currentSlide-1,i),this.loadPrevSpread())}enablePrev(i){this.prevEnabled=i}enableNext(i){this.nextEnabled=i}setSlidePages(i,s){for(var e=this,t=[],l=0;l<s.length;l++)s[l]&&t.push(s[l].index);if(!(this.slides[i].pages&&this.slides[i].pages.length>0&&t.join("")===this.slides[i].pages.join(""))){this.clearSlidePages(i);var h=this.slides[i].firstChild;s.forEach((s=>{if(void 0!==s){let t;t="number"==typeof s?s:s.index,e.pagesArr[t]&&(h.appendChild(e.pagesArr[t].wrapper),e.slides[i].pages.push(t))}})),this.resizeInnerSlides(),this.slides[i].iscroll&&this.slides[i].iscroll.refresh()}}clearSlidePages(i){this.slides[i].firstChild.innerHTML="",this.slides[i].pages=[]}loadNextSpread(){var i=this.rightIndex;this.options.rightToLeft&&!this.options.backCover&&i--;var s=this.pagesArr[i+1];if(s&&s.load(),!this.singlePage){var e=this.pagesArr[i+2];e&&e.load()}}loadPrevSpread(){var i,s=this.rightIndex;if(this.options.rightToLeft&&!this.options.backCover&&s--,this.singlePage)(i=this.pagesArr[s-1])&&i.load();else{(i=this.pagesArr[s-2])&&i.load();var e=this.pagesArr[s-3];e&&e.load()}}loadVisiblePages(){var i=this.options.main,s=this.rightIndex;!this.options.rightToLeft||this.options.backCover||this.singlePage||s--;var e=this.pagesArr[s],t=this.pagesArr[s-1],l=this.pagesArr[s+1],h=this.pagesArr[s+2],o=this.pagesArr[s-2],r=this.pagesArr[s-3];this.singlePage?e?e.load((function(){i.setLoadingProgress(1),t&&t.load(null,!0),l&&l.load(null,!0)})):t&&t.load():t?t.load((function(){e?e.load((function(){i.setLoadingProgress(1),o&&o.load(null,!0),r&&r.load(null,!0),l&&l.load(null,!0),h&&h.load(null,!0)})):(i.setLoadingProgress(1),o&&o.load(null,!0),r&&r.load(null,!0))})):e&&e.load((function(){i.setLoadingProgress(1),l&&l.load(null,!0),h&&h.load(null,!0)}))}updateVisiblePages(){if(this.visiblePagesRightIndex!==this.rightIndex){this.visiblePagesRightIndex=this.rightIndex;var i=this.rightIndex;(!this.options.rightToLeft||this.options.backCover||this.singlePage)&&this.options.cover||i--;var s=this.pagesArr[i],e=this.pagesArr[i-1],t=this.pagesArr[i+1],l=this.pagesArr[i+2],h=this.pagesArr[i-2],o=this.pagesArr[i-3];t&&t.hideHTML(),l&&l.hideHTML(),h&&h.hideHTML(),o&&o.hideHTML(),this.singlePage?(s&&s.startHTML(),e?t?(this.setSlidePages(1,[s]),e&&this.setSlidePages(0,[e]),this.setSlidePages(2,[t]),this.goToSlide(1,!0)):(s&&this.setSlidePages(2,[s]),e&&this.setSlidePages(1,[e]),this.goToSlide(2,!0),this.clearSlidePages(0)):(this.setSlidePages(0,[s]),t?this.setSlidePages(1,[t]):this.clearSlidePages(1),this.goToSlide(0,!0),this.clearSlidePages(2)),e&&e.hideHTML()):e?(e.startHTML(),s?(s.startHTML(),t?h&&(2!=this.rightIndex||this.options.cover)?(this.setSlidePages(1,[e,s]),this.setSlidePages(0,[o,h]),this.setSlidePages(2,[t,l]),this.goToSlide(1,!0)):(this.setSlidePages(0,[e,s]),this.setSlidePages(1,[t,l]),this.clearSlidePages(2),this.goToSlide(0,!0)):(this.setSlidePages(2,[e,s]),this.setSlidePages(1,[o,h]),this.goToSlide(2,!0),this.clearSlidePages(0))):(this.setSlidePages(2,[e]),this.setSlidePages(1,[o,h]),this.goToSlide(2,!0),this.clearSlidePages(0))):(s&&s.startHTML(),this.setSlidePages(0,[s]),this.setSlidePages(1,[t,l]),this.goToSlide(0,!0),this.clearSlidePages(2)),this.loadVisiblePages(),this.flippedleft=(this.rightIndex+this.rightIndex%2)/2,this.flippedright=this.numSheets-this.flippedleft,this.options.main.turnPageComplete()}}loadPage(i){this.pagesArr[i]&&this.pagesArr[i].load()}disable(){this.enabled=!1}enable(){this.enabled=!0,this.onResize()}resize(){}updateSinglePage(i){this.singlePageView=i,this.onResize(!0)}onResize(i){var s=this.main.wrapperW,e=this.main.wrapperH;if(0!=s&&0!=e&&(i||this.w!==s||this.h!==e)){this.w=s,this.h=e;var t=this.pageWidth,l=this.pageHeight,h=2*this.options.zoomMin*t/l>s/e,o=!this.options.singlePageMode&&(!this.options.responsiveView||s>this.options.responsiveViewTreshold||!h||s/e>=this.options.responsiveViewRatio);void 0!==this.singlePageView&&(o=!this.singlePageView);var r,a=o?2*t:t,n=l;this.bw=a,this.bh=n,r=e/s>n/a?n/a*s/this.options.pageHeight:e/this.options.pageHeight;for(var d=0;d<this.slides.length;d++)this.slides[d].style.width=s+0+"px",this.slides[d].style.height=e+"px",this.slides[d].style.left=d*s+0*d+"px",this.slides[d].iscroll&&(this.slides[d].iscroll.options.zoomMin=this.options.zoomMin*r,this.slides[d].iscroll.options.zoomMax=this.options.zoomMax*r,this.slides[d].iscroll.refresh());this.scroller.style.width=this.slides.length*(s+0)+"px",this.iscroll.refresh(),o&&!this.options.singlePageMode||this.singlePage?o&&!this.options.singlePageMode&&this.singlePage&&(this.rightIndex%2!=0&&this.setRightIndex(this.rightIndex+1),this.singlePage=!1,this.view=2,this.resizeInnerSlides()):(this.rightIndex%2==0&&this.rightIndex>0&&this.setRightIndex(this.rightIndex-1),this.singlePage=!0,this.view=1,this.resizeInnerSlides()),this.zoomTo(this.zoom)}}isFocusedRight(){return this.rightIndex%2==0}isFocusedLeft(){return this.rightIndex%2==1}resizeInnerSlides(){var i=this.options.pageHeight*this.pageWidth/this.pageHeight;90!=this.rotation&&270!=this.rotation||(i=this.options.pageHeight*this.pageHeight/this.pageWidth);for(var s=this.singlePage?i:2*i,e=0;e<3;e++)s=this.slides[e].pages&&1==this.slides[e].pages.length?i:2*i,this.slides[e].firstChild.style.width=`${s}px`}goToSlide(i,s){if(this.iscroll.currentPage.pageX!=i){if(!s){if(this.flipping)return;this.flipping=!0,this.wrapper.style.pointerEvents="none",this.disableIscroll()}this.onResize();var e=s?0:600*this.options.pageFlipDuration,t=this.slides[i];t.pages&&t.pages[0]&&this.pagesArr[t.pages[0]].updateHtmlContent(),this.iscroll.pages.length>0&&this.iscroll.goToPage(i,0,e),s&&(this.currentSlide=i),this.zoomTo(this.options.zoomMin)}}zoomIn(i,s,e){e&&"mousewheel"===e.type||this.zoomTo(i)}zoomTo(i,s,e,t){if(this.enabled&&!this.zoomDisabled&&(e=e||0,t=t||0,i>1&&this.disableFlip(),0!=h&&0!=o)){var l=this.main,h=l.wrapperW,o=l.wrapperH,r=l.bookW,a=l.bookH,n=l.pageW,d=l.pageH,p=h/o,g=n/d,c=Math.min(this.zoom,1),m=Number(this.options.zoomMin),P=this;!this.options.singlePageMode&&this.options.responsiveView&&h<=this.options.responsiveViewTreshold&&p<2*g&&p<this.options.responsiveViewRatio?(this.view=1,this.sc=g>p?m*p/(g*c):1,h/o>n/d?u():S()):this.singlePage&&p<2*g?(this.sc=g>p?m*p/(g*c):1,h/o>n/d?u():S()):(this.view=2,this.sc=p<2*g?m*p/(2*g*c):1,h/o>=r/a?u():S()),this.zoom=i,this.onZoom(i)}function u(){P.ratio=o/a,b()}function S(){P.ratio=1==P.view?h/n:h/r,b()}function b(){for(var s=0;s<3;s++)P.slides[s].iscroll&&(P.slides[s].iscroll.options.zoomMin=P.ratio*P.options.zoomMin,P.slides[s].iscroll.options.zoomMax=P.ratio*P.options.zoomMax,P.slides[s].iscroll.zoom(P.ratio*i,e,t,0))}}zoomOut(i){this.zoomTo(i)}move(i){if(!(this.zoom<=1))for(var s=0;s<3;s++){var e=this.slides[s].iscroll;if(e){var t=e.x,l=e.y,h=20*this.zoom;switch(i){case"left":t+=h;break;case"right":t-=h;break;case"up":l+=h;break;case"down":l-=h}t>0&&(t=0),t<e.maxScrollX&&(t=e.maxScrollX-0),l>0&&(l=0),l<e.maxScrollY&&(l=e.maxScrollY-0),e.scrollTo(t,l,0)}}}onZoom(i){i>1?(this.disableFlip(),this.enablePan()):(this.enableFlip(),this.disablePan()),this.options.main.onZoom(i)}rotateLeft(){this.rotation=(this.rotation+360-90)%360;for(var i=0;i<this.pagesArr.length;i++){this.pagesArr[i].setRotation(this.rotation)}this.resizeInnerSlides(),this.onResize()}rotateRight(){this.rotation=(this.rotation+360+90)%360;for(var i=0;i<this.pagesArr.length;i++){this.pagesArr[i].setRotation(this.rotation)}this.resizeInnerSlides(),this.onResize()}onSwipe(i,s,e,t){}onPageUnloaded(i){var s=this.options.rightToLeft?this.options.numPages-i-1:i;this.pagesArr[s].unload()}disableFlip(){this.flipEnabled=!1,this.iscroll.disable()}enableFlip(){1!=this.options.numPages?(this.flipEnabled=!0,this.iscroll.enable()):this.disableFlip()}enablePan(){this.slides[0].iscroll&&this.slides[0].iscroll.enable(),this.slides[1].iscroll&&this.slides[1].iscroll.enable(),this.slides[2].iscroll&&this.slides[2].iscroll.enable()}disablePan=function(){this.slides[0].iscroll&&this.slides[0].iscroll.disable(),this.slides[1].iscroll&&this.slides[1].iscroll.disable(),this.slides[2].iscroll&&this.slides[2].iscroll.disable()}},FLIPBOOK.PageSwipe=class{constructor(i,s,e,t){this.rotation=0,this.index=s,this.options=i.options,this.texture=e,this.html=t,this.index=s,this.wrapper=document.createElement("div"),this.wrapper.classList.add("flipbook-carousel-page"),this.wrapper.dataset.page=s+1,this.main=i.main,this.book=i,this.inner=document.createElement("div"),this.inner.classList.add("flipbook-carousel-page-inner"),this.wrapper.appendChild(this.inner),this.bg=document.createElement("div"),this.bg.classList.add("flipbook-carousel-page-bg"),this.inner.appendChild(this.bg),this.htmlElement=document.createElement("div"),this.htmlElement.classList.add("flipbook-page3-html"),this.htmlElement.style.width=1e3*this.options.pageWidth/this.options.pageHeight+"px",this.htmlElement.style.transform="scale("+this.options.pageHeight/1e3+") translateZ(0)",this.inner.appendChild(this.htmlElement),this.options.doublePage&&(!this.options.rightToLeft&&this.index%2==0&&this.index>0||this.options.rightToLeft&&this.index%2==1&&this.index>0?this.htmlElement.style.left="-100%":this.htmlElement.style.left="0"),this.options.pagePreloader?(this.preloader=document.createElement("img"),this.preloader.src=this.options.pagePreloader,this.preloader.classList.add("flipbook-page-preloader-image"),this.inner.appendChild(this.preloader)):(this.preloader=document.createElement("img"),this.preloader.src=this.options.assets.spinner,this.preloader.classList.add("flipbook-page-preloader"),this.inner.appendChild(this.preloader)),this.setSize(this.pw,this.ph)}load(i,s){var e=this.options.pageTextureSize;if(this.size>=e)return s||this.loadHTML(),void(i&&i.call(this));this.size=e;var t=this,l=this.options.rightToLeft?this.options.numPages-this.index-1:this.index,h=this.options.pages[l];this.options.main.loadPage(l,e,(function(l){if((l=l||{})&&l.image){var o=l.image[e]||l.image;o.classList.add("page-carousel-img"),t.index%2==0&&(h&&"left"==h.side||h&&"right"==h.side)&&(o.clone||(o.clone=new Image,o.clone.src=o.src),o=o.clone),t.bg.appendChild(o),t.options.rightToLeft?(t.options.doublePage&&t.index<t.options.numPages-1&&t.index%2==1&&(o.style.left="-100%"),t.options.doublePage?t.index==t.options.numPages-1||0==t.index&&t.options.backCover?o.style.width="100%":o.style.width="200%":o.style.width="100%"):(t.options.doublePage&&t.index>0&&t.index%2==0&&(o.style.left="-100%"),t.options.doublePage?0==t.index||t.index==t.options.numPages-1&&t.options.backCover?o.style.width="100%":o.style.width="200%":o.style.width="100%"),t.preloader.remove()}t.setRotation(),s||t.loadHTML(),i&&i.call(t)}))}loadHTML(){var i=this,s=this.options.rightToLeft?this.options.numPages-this.index-1:this.index;this.htmlContent?this.updateHtmlContent():this.options.main.loadPageHTML(s,(function(s){i.htmlContent=s,i.updateHtmlContent()}))}hideHTML(){this.htmlContentVisible&&(this.htmlElement.innerHTML="",this.htmlContentVisible=!1,this.main.trigger("hidepagehtml",{page:this}))}startHTML(){this.book.startPageItems(this.wrapper)}unload(){this.pageSize=0,this.size=0,this.inner.appendChild(this.preloader)}dispose(){this.pageSize&&(this.pageSize=null,this.bg.innerHTML="")}setSize(){var i=this.options.pageWidth,s=this.options.pageHeight;0===this.rotation||180===this.rotation?(this.wrapper.style.width=i+"px",this.wrapper.style.height=s+"px",this.pw=i,this.ph=s):(this.wrapper.style.width=s+"px",this.wrapper.style.height=i+"px",this.pw=s,this.ph=i),this.updateHtmlContent()}setRotation(i){this.setSize(),this.options.doublePage||(void 0!==i&&(this.rotation=i),this.img&&(this.img.style.transform="rotate("+this.rotation+"deg) translateZ(0)",90===this.rotation||270===this.rotation?(this.img.style.width=this.wrapper.clientHeight+"px",this.img.style.height=this.wrapper.clientWidth+"px"):(this.img.style.width=this.wrapper.clientWidth+"px",this.img.style.height=this.wrapper.clientHeight+"px")))}updateHtmlContent(){this.htmlContent&&!this.htmlContentVisible&&(this.htmlContentVisible=!0,this.htmlElement.innerHTML="",this.htmlElement.appendChild(this.htmlContent),this.main.trigger("showpagehtml",{page:this})),this.startHTML()}};