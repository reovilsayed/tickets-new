import{P as U,r as t,a as v,B as b,j as e}from"./app-128f677e.js";import{e as z}from"./qr-scanner.min-d73c2c4c.js";const K=()=>{var S;const[N]=U(),l=N.get("tickets"),[r,h]=t.useState((l==null?void 0:l.split(","))??[]),E=(S=l==null?void 0:l.split(","))==null?void 0:S.length,o=t.useRef(null),[n,m]=t.useState(null),[q,i]=t.useState(!1),[T,f]=t.useState(!1),[C,x]=t.useState(!1),[d,g]=t.useState(0),[y,u]=t.useState(!1),[p,k]=t.useState("");t.useEffect(()=>{if(o.current&&!n){const s=new z(o.current,a=>{y||M(a)},{highlightScanRegion:!0,highlightCodeOutline:!0});m(s)}return()=>{n&&(n.stop(),n.destroy(),m(null))}},[o,n,y]);const P=()=>{n?(i(!0),f(!0),n.start()):console.error("Scanner is not initialized yet")},w=()=>{i(!0),x(!0)},M=async s=>{const a=r[r.length-1];if(!(!(s!=null&&s.data)||!a)){i(!1),f(!1),u(!0),n&&n.stop();try{await v.post("https://events.essenciacompany.com/api/tickets/update-code",{ticket:a,code:s==null?void 0:s.data}),h(c=>{const j=[...c];return j.pop(),j}),g(c=>c+1)}catch{b.error("Error scanning ticket")}finally{u(!1)}}},R=async()=>{const s=r[r.length-1];if(!(!p||!s)){x(!1),i(!1),u(!0);try{await v.post("https://events.essenciacompany.com/api/tickets/update-code",{ticket:s,code:p}),h(a=>{const c=[...a];return c.pop(),c}),g(a=>a+1),k("")}catch{b.error("Error updating ticket manually")}finally{u(!1)}}},Q=s=>{s.key==="Enter"&&R()};return e.jsxs("section",{className:"scanner-page",style:{display:"flex",flexDirection:"column"},children:[e.jsxs("h3",{children:[d," / ",E," tickets processed"]}),q?"":r!=null&&r.length?e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"qr-box flex-column",onClick:P,children:[e.jsx("img",{className:"qr-image",src:"/assets/qr-code.png",alt:"QR Code"}),e.jsxs("h3",{children:["start scanning",d>0?" next":""]})]}),e.jsxs("div",{className:"qr-box flex-column",onClick:w,children:[e.jsx("img",{className:"qr-image",src:"/assets/keyboard.svg",alt:"keyboard"}),e.jsxs("h3",{children:["Enter manually",d>0?" next":""]})]})]}):e.jsx("a",{href:"/pos/tickets",className:"qr-box flex-column",children:e.jsxs("h3",{style:{textTransform:"capitalize",textAlign:"center"},children:["All tickets are done scanning",e.jsx("br",{}),e.jsx("br",{}),"Go back to tickets"]})}),e.jsx("div",{id:"viewfinder",className:"qr-box",style:T?{}:{display:"none"},children:e.jsx("video",{ref:o,children:"Your browser does not support video playback."})}),e.jsx("div",{id:"manual-input",className:"form-group",style:C?{}:{display:"none"},children:e.jsx("input",{type:"text",name:"manual",className:"form-control",id:"manual",value:p,onChange:s=>k(s.target.value),onKeyDown:Q,placeholder:"Enter ticket code manually"})})]})};export{K as default};
