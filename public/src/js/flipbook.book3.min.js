"use strict";FLIPBOOK.Book3=class extends FLIPBOOK.Book{constructor(t,e,i){super(e,i),this.wrapper=t,this.wrapper.classList.add("flipbook-book3"),this.bookLayer=this.wrapper.parentNode,this.flipEasing="easeOutQuad",this.translateZ="",this.iscroll=new FLIPBOOK.IScroll(this.bookLayer,{zoom:!0,scrollX:!0,scrollY:!0,scrollbars:!0,keepInCenterV:!0,keepInCenterH:!0,freeScroll:!0,preventDefault:!1}),e.on("disableIScroll",this.disableIscroll.bind(this)),e.on("enableIScroll",this.enableIscroll.bind(this)),this.iscroll.on("zoomEnd",(()=>{if(isNaN(this.iscroll.scale))return this.zoomTo(i.zoomMin);i.main.onZoom(this.iscroll.scale/this.ratio),this.updateVisiblePages();const t=i.main.zoom>1;if(this.zoomed!==t){const e=this.iscroll.options;e.eventPassthrough=t?"":"vertical",e.freeScroll=t,this.iscroll.refresh(),this.zoomed=t}})),this.wrapper.style.width=2*this.pageWidth+"px",this.wrapper.style.height=`${this.pageHeight}px`,this.centerContainer=document.createElement("div"),this.centerContainer.className="flipbook-center-container3",this.centerContainer.style.width=2*this.pageWidth+"px",this.centerContainer.style.height=`${this.pageHeight}px`,this.wrapper.appendChild(this.centerContainer);const s=this.options.perspective||("3d"===this.options.viewMode?3*this.pageHeight:2e5);this.centerContainer.style.perspective=`${s}px`,this.pagesArr=[],this.animating=!1;var h=this.options.pages,a=h.length%2==0,o=a?h.length/2:(h.length+1)/2;!this.options.cover&&a&&(o+=1),this.options.singlePageMode&&(o=h.length),this.numSheets=o;for(let t=0;t<h.length;t++){const e=new FLIPBOOK.Page3(this,t);this.pagesArr.push(e),this.centerContainer.appendChild(e.wrapper)}}enableIscroll(){this.iscrollDisabled&&(this.iscroll.enable(),this.iscrollDisabled=!1)}disableIscroll(){this.iscrollDisabled||(this.iscroll.disable(),this.iscroll.initiated=!1,this.iscrollDisabled=!0)}enableMouseWheelZoom(){this.iscroll.options.eventPassthrough="vertical",this.iscroll.refresh()}disableMouseWheelZoom(){this.iscroll.options.eventPassthrough="",this.iscroll.refresh()}enablePrev(t){this.prevEnabled=t}enablePan(){this.iscroll.enable()}disablePan(){this.iscroll.disable()}setRightIndex(t){this.rightIndex=t}enableNext(t){this.nextEnabled=t}isZoomed(){return this.options.main.zoom>this.options.zoomMin&&this.options.main.zoom>1}getNumPages(){}move(t){if(!(this.zoom<=1)){var e=this.iscroll;if(e){var i=e.x,s=e.y,h=20*this.zoom;switch(t){case"left":i+=h;break;case"right":i-=h;break;case"up":s+=h;break;case"down":s-=h}i>0&&(i=0),i<e.maxScrollX&&(i=e.maxScrollX-0),s>0&&(s=0),s<e.maxScrollY&&(s=e.maxScrollY-0),e.scrollTo(i,s,0)}}}zoomTo(t,e,i,s){if(this.enabled){i=i||0,s=s||0,e=e||0,this.zoom=t,e=0;var h=this.iscroll;h&&h.zoom(t*this.ratio,i,s,e)}}setWrapperW(t){this.wrapperW!=t&&(this.wrapper.style.width=t+"px",this.wrapperW=t)}updateBookPosition(){if(this.singlePage)return this.setWrapperW(this.pageWidth),this.iscroll&&this.iscroll.refresh(),this.view=1,void this.focusRight();1==this.view?this.setWrapperW(this.pageWidth):this.setWrapperW(2*this.pageWidth),this.iscroll&&this.iscroll.refresh(),2==this.view?this.isCover()?this.focusRight():this.isBackCover()&&this.options.cover?this.focusLeft():this.focusBoth():1==this.view&&(this.isCover()?this.focusRight():this.isBackCover()&&this.focusLeft())}focusLeft(t,e){var i=1==this.view||this.singlePage?0:this.pageWidth/2;this.setBookPosition(i,t,e)}focusRight(t,e,i){var s=1==this.view||this.singlePage?-this.pageWidth:-this.pageWidth/2;this.setBookPosition(s,t,e,i)}focusBoth(t,e){var i=1==this.view?-this.pageWidth/2:0;this.setBookPosition(i,t,e)}setBookPosition(t,e,i,s){if(this.centerContainerPosition!=t){var h=this.centerContainerPosition;if(e){var a=this;const o={from:h,to:t,delay:i=i||0,duration:e,step(t){a.centerContainer.style.transform="translateX("+t+"px) "+a.translateZ},complete(){a.centerContainerPosition=t,s&&(a.updateFlipped(),a.options.main.turnPageComplete())}};this.animate(o)}else this.centerContainerPosition!=t&&(this.centerContainerPosition=t,this.centerContainer.style.transform="translateX("+t+"px) "+this.translateZ,this.updateFlipped(),this.options.main.turnPageComplete())}}updateSinglePage(t){if(t==this.singlePage)return;this.singlePage=t;var e=this.options.pages,i=e.length%2==0,s=i?e.length/2:(e.length+1)/2;!this.options.cover&&i&&(s+=1),(this.options.singlePageMode||this.singlePage)&&(s=e.length),this.numSheets=s;let h=this.rightIndex;h>0&&(this.singlePage?h--:h%2==1&&h++,this.setRightIndex(h)),this.resetLoadedPages(),this.onResize(),this.updateVisiblePages()}resetLoadedPages(){this.pagesArr.forEach((function(t){t.bgFront&&t.bgFront.replaceChildren(),t.bgBack&&t.bgBack.replaceChildren(),t.sizeFront=0,t.sizeBack=0,t.html.front&&t.html.front.replaceChildren(),t.html.back&&t.html.back.replaceChildren(),t.htmlContent&&(t.htmlContent.front=null,t.htmlContent.back=null),t.htmlLoaded&&(t.htmlLoaded.front=null,t.htmlLoaded.back=null),t._sidePromises=null,t._sideHTMLPromises=null}))}async updateVisiblePages(t){void 0===t&&(t=!0);var e=this.rightIndex;this.singlePage||(e/=2);var i=this.options.pages,s=i.length%2==0,h=s?i.length/2:(i.length+1)/2;!this.options.cover&&s&&(h+=1),(this.options.singlePageMode||this.singlePage)&&(h=i.length),this.visibleSheets=[];for(let t=0;t<h;t++)this.visibleSheets.push(this.pagesArr[t]);var a=this.visibleSheets[e],o=this.visibleSheets[e+1],n=this.visibleSheets[e-1],r=this.visibleSheets[e-2];n&&n._setAngle(180),a&&a._setAngle(0);for(var l=0;l<this.pagesArr.length;l++)this.pagesArr[l]==a?(this.pagesArr[l].show(),this.pagesArr[l].unpauseHtml("front"),this.pagesArr[l].pauseHtml("back")):this.pagesArr[l]!=n||this.singlePage?this.pagesArr[l].hide():(this.pagesArr[l].show(),this.pagesArr[l].unpauseHtml("back"),this.pagesArr[l].pauseHtml("front")),this.pagesArr[l]._setZIndex(0);this.updateBookPosition(),this.options.main.setLoadingProgress(.1),n&&!this.singlePage&&await this.loadPageAsync(n,"back"),a&&this.loadPageAsync(a,"front"),this.options.main.setLoadingProgress(1),n&&!this.singlePage&&await this.loadHTMLAsync(n,"back"),a&&await this.loadHTMLAsync(a,"front"),o&&await this.loadPageAsync(o,"front"),a&&await this.loadPageAsync(a,"back"),r&&await this.loadPageAsync(r,"back"),n&&await this.loadPageAsync(n,"front")}enable(){this.onResize(),this.enabled=!0}disable(){this.enabled=!1}getLeftPage(){return this.pagesArr[this.flippedleft-1]}getRightPage(){return this.pagesArr[this.flippedleft]}getLeftBackPage(){return this.pagesArr[this.flippedleft-2]}getRightBackPage(){return this.pagesArr[this.flippedleft+1]}getNextPage(){return this.pagesArr[this.flippedleft+2]}getPrevPage(){return this.pagesArr[this.flippedleft-3]}nextPage(){if(this.nextEnabled)if(1!=this.view||!this.isFocusedLeft()||this.singlePage)this.goToPage(this.rightIndex+2);else{var t=700*this.options.pageFlipDuration/2;this.focusRight(t,0,!0)}}prevPage(){if(this.prevEnabled)if(1!=this.view||!this.isFocusedRight()||this.singlePage){var t=this.singlePage?this.rightIndex:this.rightIndex-2;this.goToPage(t)}else{var e=700*this.options.pageFlipDuration/2;this.focusLeft(e,0,!0)}}goToPage(t,e){if(this.enabled&&!this.flipping&&!isNaN(t)&&((this.singlePage||t%2!=0)&&t--,t<0&&(t=0),t>2*this.numSheets&&(t=2*this.numSheets),t!=this.rightIndex))if(e||this.options.instantFlip)this.setRightIndex(t),this.updateFlipped(),this.updateVisiblePages(),this.options.main.turnPageComplete();else{var i,s=this,h=600*this.options.pageFlipDuration,a=this.flipEasing;t>this.rightIndex?(i=180,(s.angle<=0||s.angle>=180||!s.angle)&&(s.angle=1)):t<this.rightIndex&&(i=-180,(s.angle>=0||s.angle<=-180||!s.angle)&&(s.angle=-1)),this.flipping=!0,this.singlePage||(1==this.view?t<this.rightIndex?this.focusRight(h):this.focusLeft(h):0==t?this.focusRight(h):t==2*this.visibleSheets.length?this.focusLeft(h):this.focusBoth(h)),this.goingToPage=t,this.singlePage&&(h/=2);const e={from:s.angle,to:i,duration:h,easing:a,step(t){s._setPageAngle(t)},complete(){s.setRightIndex(s.goingToPage),s.angle=0,s.flipping=!1,s.updateFlipped(),s.updateVisiblePages(),s.options.main.turnPageComplete()}};this.animate(e),this.options.main.turnPageStart()}}animate(t){FLIPBOOK.animate(t)}updateFlipped(){this.singlePage?this.flippedleft=this.rightIndex:this.flippedleft=(this.rightIndex+this.rightIndex%2)/2,this.flippedright=this.numSheets-this.flippedleft}onSwipe(t,e,i,s,h,a){if(this.isZoomed()||"flipbook-page-link"===t.target.className||this.flipping)return;const o=180*-i/this.main.wrapperW,n=Math.abs(i);if("start"!==e){if(("end"===e||"cancel"===e)&&a<=1&&n>5)return o>0?this.nextPage():this.prevPage(),void(this.dragging=!1);if("move"===e&&a<=1&&this.dragging&&n>5){let t=o>0?this.singlePage?1:2:this.singlePage?-1:-2;if(o>0&&!this.nextEnabled||o<0&&!this.prevEnabled)return;this.goingToPage=this.rightIndex+t,this.goingToPage!==this.rightIndex&&this.goingToPage>=0&&this.goingToPage<=2*this.pagesArr.length&&!this.options.instantFlip&&this._setPageAngle(o)}}else this.dragging=!0}pauseHtml(){for(var t=0;t<this.pagesArr.length;t++)this.pagesArr[t].pauseHtml()}_setPageAngle(t){if(this.angle!=t){var e,i,s,h;this.angle=t,this.angle=t;var a,o=this.rightIndex,n=this.goingToPage;if(this.singlePage)h=this.visibleSheets[o],s=this.visibleSheets[o-1],t>0?(h._setAngle(t/2),(i=this.visibleSheets[n])&&(i.show(),this.loadPageAsync(i,"front"))):((s=this.visibleSheets[n]).show(),this.loadPageAsync(s,"front"),s._setAngle(t/2+90)),i&&i._setAngle(0),e&&e._setAngle(90);else{h=this.visibleSheets[o/2],s=this.visibleSheets[o/2-1];var r=this.visibleSheets[n/2-1],l=this.visibleSheets[n/2];if(t>0){if(1==this.view&&this.isFocusedLeft())return;t<90?(a=h,r&&r.hide()):(a=r,h.hide()),a.show(),a._setAngle(t),(i=this.visibleSheets[n/2])&&(i.show(),this.loadPageAsync(i,"fornt")),this.loadPageAsync(a,"back")}else{if(1==this.view&&this.isFocusedRight())return;t>-90?(a=s,l&&l.hide()):(a=l,s.hide()),a.show(),a._setAngle(180+t),(e=this.visibleSheets[n/2-1])&&(e.show(),this.loadPageAsync(e,"back")),this.loadPageAsync(a,"front")}i&&i._setAngle(0),e&&e._setAngle(180)}}}isCover(){return 0==this.rightIndex}isBackCover(){return this.rightIndex==2*this.numSheets}onPageUnloaded(t){var e=t;this.options.rightToLeft&&(e=2*this.pagesArr.length-t-1),this.pagesArr[e]&&this.pagesArr[e].unload()}onResize(){var t=this,e=this.main,i=e.wrapperW,s=e.wrapperH,h=e.bookW,a=e.bookH,o=e.pageW,n=e.pageH,r=i/s,l=o/n,g=this.options;function p(){t.ratio=s/a,c()}function d(){t.ratio=1==t.view?i/o:i/h,c()}function c(){t.iscroll&&(t.iscroll.options.zoomMin=t.ratio*g.zoomMin),t.iscroll&&(t.iscroll.options.zoomMax=t.ratio*g.zoomMax),t.updateBookPosition(),t.iscroll&&t.iscroll.zoom(t.ratio*g.main.zoom,i/2,s/2,0),t.bookScale=t.iscroll.scale}var m=Math.min(this.zoom,1),f=Number(this.options.zoomMin);this.singlePage||this.options.responsiveView&&i<=this.options.responsiveViewTreshold&&r<2*l&&r<this.options.responsiveViewRatio?(this.view=1,this.sc=l>r?f*r/(l*m):1,i/s>o/n?p():d()):(this.view=2,this.sc=r<2*l?f*r/(2*l*m):1,i/s>=h/a?p():d()),this.updateBookPosition(),this.updateFlipped(),this.options.main.turnPageComplete()}isFocusedRight(){var t=1==this.view?-this.pageWidth/2:0;return this.singlePage?this.rightIndex%2==0:this.centerContainerPosition<t}isFocusedLeft(){var t=1==this.view?-this.pageWidth/2:0;return this.singlePage?this.rightIndex%2==1:this.centerContainerPosition>t}},FLIPBOOK.Page3=class{constructor(t,e){this.book=t,this.main=t.main,this.options=t.options,this.index=e,this.wrapper=document.createElement("div"),this.wrapper.className="flipbook-page3",this.wrapper.style.width=t.options.pageWidth+"px",this.wrapper.style.height=t.options.pageHeight+"px",this.angle=0,this.wrapper.dataset.sheet=e;var i=t.options;let s=i.pagePreloader||i.assets.spinner,h=i.pagePreloader?"flipbook-page-preloader-image":"flipbook-page-preloader";this.front=document.createElement("div"),this.wrapper.appendChild(this.front),this.front.className="flipbook-page3-inner flipbook-page3-inner-front",this.bgFront=document.createElement("div"),this.front.appendChild(this.bgFront),this.bgFront.className="flipbook-page3-bg",this.htmlFront=document.createElement("div"),this.front.appendChild(this.htmlFront),this.htmlFront.className="flipbook-page3-html page_"+String(2*e),this.htmlFront.style.width=1e3*i.pageWidth/i.pageHeight+"px";var a="scale("+this.options.pageHeight/1e3+")";this.options.doublePage&&this.index>0?this.htmlFront.style.transform=a+" translateX(-100%)":this.htmlFront.style.transform=a,this.html={front:this.htmlFront},this.frontHtmlContentVisible=!1,this.preloaderFront=new Image,this.preloaderFront.src=s,this.preloaderFront.className=h,this.front.appendChild(this.preloaderFront),t.singlePage||(this.back=document.createElement("div"),this.wrapper.appendChild(this.back),this.back.className="flipbook-page3-inner flipbook-page3-inner-back",this._setVisibility(this.back,!1),this.bgBack=document.createElement("div"),this.back.appendChild(this.bgBack),this.bgBack.className="flipbook-page3-bg",this.htmlBack=document.createElement("div"),this.back.appendChild(this.htmlBack),this.htmlBack.className="flipbook-page3-html page_"+String(2*e+1),this.htmlBack.style.width=1e3*i.pageWidth/i.pageHeight+"px",this.htmlBack.style.transform=a,this.html.back=this.htmlBack,this.backHtmlContentVisible=!1,this.preloaderBack=new Image,this.preloaderBack.src=s,this.preloaderBack.className=h,this.back.appendChild(this.preloaderBack)),this.htmlPaused={front:!1,back:!1},this.hide(),this.zIndex=0,this.options.rightToLeft&&!this.options.backCover&&e++,this.wrapper.style.left=String(this.book.options.pageWidth-1)+"px"}load(t,e,i){var s=this.options,h="front"==t||this.book.singlePage,a=this.book.singlePage?this.index:h?2*this.index:2*this.index+1,o=s.rightToLeft?2*this.book.pagesArr.length-a-1:a;if(this.sizeFront==e&&h&&this.indexFront==o||this.sizeBack==e&&!h&&this.indexBack==o)i&&i.call(this);else{h?this.sizeFront=e:this.sizeBack=e;var n=this;s.cover||o--,h?this.indexFront=o:this.indexBack=o,s.main.loadPage(o,e,(function(t){if(t&&t.image){var a=t.image[e]||t.image;t=s.pages[o];(h&&t&&"right"==t.side||s.rightToLeft&&h&&t&&"left"==t.side)&&(a.clone||(a.clone=new Image,a.clone.src=a.src),(a=a.clone).style.transform="translateX(-50%)"),h?(n.bgFront&&n.bgFront.replaceChildren(a),n.preloaderFront&&(n.preloaderFront.style.display="none")):(n.bgBack&&n.bgBack.replaceChildren(a),n.preloaderBack&&(n.preloaderBack.style.display="none"))}i&&i.call(n)}))}}loadHTML(t,e){var i=this,s="front"==t,h=this.book.singlePage?this.index:s?2*this.index:2*this.index+1,a=this.options,o=a.rightToLeft?2*this.book.pagesArr.length-h-1:h;o<0?e.call(i):(a.cover||o--,this.htmlContent&&this.htmlContent[t]?(this.updateHtmlContent(t),e.call(this)):this.options.main.loadPageHTML(o,(function(s){i.htmlContent=this.htmlContent||{},i.htmlContent[t]=s,i.updateHtmlContent(t),e.call(i)})))}startHTML(t){this.book.startPageItems(this.html[t])}unload(){this.size=null,this.mat=!1,this.pageSize=null}pauseHtml(t){this.htmlPaused[t]||(this.htmlPaused[t]=!0)}unpauseHtml(t){this.htmlPaused[t]=!1,this.removedIframes&&this.removedIframes.length&&this.removedIframes.forEach((function(t){t.parentNode.appendChild(t.iframe)})),this.removedIframes=[]}showHtml(){this.htmlContentVisible||(this.htmlContentVisible=!0)}updateHtmlContent(t){if(this.htmlLoaded=this.htmlLoaded||{},!this.htmlLoaded[t]){var e=this.htmlContent[t];e.jquery&&(e=e[0]),this.htmlLoaded[t]=!0;var i=this.html[t];i&&i.appendChild(e),this.main.trigger("showpagehtml",{page:this})}this.startHTML(t)}show(){this.hidden&&(this.wrapper.style.display="block",this.setShadowOpacity(0),this.showHtml()),this.hidden=!1}setShadowOpacity(t){this.shadowOpacity==t||this.hidden||(this.wrapper.style.setProperty("--page3-shadow-opacity",t),this.shadowOpacity=t)}hide(){this.hidden||(this.wrapper.style.display="none",this.setShadowOpacity(0),this.pauseHtml("front"),this.pauseHtml("back")),this.hidden=!0}_setVisibility(t,e){t&&t.dataset.visible!=e&&(t.dataset.visible=e,t.style.opacity=e?"1":"0",t.style.pointerEvents=e?"auto":"none")}_setAngle(t){if((t=-t)!=this.angle){var e;this.setShadowOpacity(.2*(1-Math.abs(t+90)/90)),this.wrapper.style.setProperty("--page3-rotate-y",String(t+"deg")),this._setVisibility(this.front,t>-90),this._setVisibility(this.back,t<-90),this.angle=t;var i=0;for(e=0;e<this.book.pagesArr.length;e++)e!=this.index&&this.book.pagesArr[e].zIndex>i&&(i=this.book.pagesArr[e].zIndex);this._setZIndex(i+1)}}_setZIndex(t){this.zIndex!=t&&(this.wrapper.style["z-index"]=t),this.zIndex=t}};